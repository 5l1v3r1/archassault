# Maintainer: ArchAssault <team@archassault.org>
pkgname=fruitywifi-git
pkgver=r136.e6ec748
pkgrel=5
groups=('archassault' 'archassault-networking')
pkgdesc=()
arch=('i686' 'x86_64' 'armv7h' 'armv6h')
url=https://github.com/xtr4nge/FruityWifi
license=('GPL3')
depends=('gettext' 'intltool' 'php' 'dos2unix' 'curl' 'dnsmasq' 
	'hostapd' 'libnl1' 'libnl' 'openssl' 'networkmanager' 'wireless_tools'
	'aircrack-ng' 'apache' 'php-apache')
makedepends=('git')
provides=('fruitywifi')
conflicts=('fruitywifi')
replaces=('fruitywifi')
source=("git+https://github.com/xtr4nge/FruityWifi.git")
md5sums=('SKIP')

pkgver() {
  cd "$srcdir"/FruityWifi
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  find "$srcdir"/FruityWifi -type d -exec chmod 755 {} +
  find "$srcdir"/FruityWifi -type f -exec chmod 644 {} +
}

build() {
  cd "$srcdir"/FruityWifi/FruityWifi/bin
  gcc danger.c -o danger
}

#package() {
#  cd "$srcdir"/FruityWifi
#  install -dm755 "$pkgdir"/usr/share/fruitywifi
#  install -dm755 "$pkgdir"/srv/http/tmp
#  install 
#  install -Dm4755 FruityWifi/bin/danger "$pkgdir"/usr/bin/danger
#  install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/fruitywifi-git
#  cp -a FruityWifi/* "$pkgdir"/usr/share/fruitywifi
#  rm -rf "$pkgdir"/usr/share/fruitywifi/bin
#  ln -s /usr/share/fruitywifi/www "$pkgdir"/srv/http/fruitywifi
#  ln -s /usr/share/fruitywifi/logs "$pkgdir"/srv/http/fruitywifi/logs
#  chown -R http:http "$pkgdir"/srv/http/tmp
#  chmod 0755 "$pkgdir"/usr/share/fruitywifi/squid.inject/poison.pl
#  ln -s /usr/share/fruitywifi/www.site "$pkgdir"/srv/http/site
#  chown -R http:http "$pkgdir"/usr/share/fruitywifi/www.site
#  chmod 777 "$pkgdir"/usr/share/fruitywifi/www.site/data.txt
#  chmod 777 "$pkgdir"/usr/share/fruitywifi/www.site/inject/data.txt
#}

package() {
  cd "$srcdir"/FruityWifi
  install -dm755 "$pkgdir"/usr/share
  cp -a FruityWifi "$pkgdir"/usr/share
  install -dm755 "$pkgdir"/srv/http/FruityWifi

  for l in $(ls FruityWifi/www) ; do ln -s /usr/share/FruityWifi/www/$l $pkgdir/srv/http/FruityWifi ; done

#  ln -s /usr/share/FruityWifi/www "$pkgdir"/srv/http/FruityWifi
  ln -s /usr/share/FruityWifi/logs "$pkgdir"/srv/http/FruityWifi/logs
  install -dm777 "$pkgdir"/srv/http/tmp
  chown http:http "$pkgdir"/srv/http/tmp
  chmod 0755 "$pkgdir"/usr/share/FruityWifi/squid.inject/poison.pl
  ln -s /usr/share/FruityWifi/www.site "$pkgdir"/srv/http/site
  chown -R http:http "$pkgdir"/usr/share/FruityWifi/www.site
  chmod 777 "$pkgdir"/usr/share/FruityWifi/www.site/data.txt
  chmod 777 "$pkgdir"/usr/share/FruityWifi/www.site/inject/data.txt
  rm -rf "$pkgdir"/usr/share/fruitywifi/bin
}
