# Maintainer: ArchAssault <team@archassault.org> <https://archassault.org>
pkgname=xplico
pkgver=1.1.0
pkgrel=1
pkgdesc="The goal of the project is to extract from an internet traffic capture the applications data contained within"
arch=('armv6h' 'i686' 'armv7h' 'x86_64')
url="http://sourceforge.net/projects/xplico"
license=('GPL2')
groups=('archassault')
depends=('libpcap' 'linux-headers' 'jshon' 'gettext' 'tcpdump' 'sox' 'lame' 'sqlite2' 'geoip' 'ndpi-svn' 'videosnarf' 'ghostpdl')
optdepends=('geoip-citydata' 'apache' 'php')
source=(http://downloads.sourceforge.net/sourceforge/xplico/xplico-${pkgver}.tgz)
sha512sums=('d3a064dfd2ff632d7074ca9e770d89d4fded296f9235b16c6581484ccc0e1bf038780bcfc65f73559a142c0c40115ff574a5a59be10ec060691da1b06da0be5e')

prepare() {
  cp /usr/include/libndpi/* "$srcdir/$pkgname-$pkgver"
  cp /usr/share/ghostpdl/pcl6 "$srcdir/$pkgname-$pkgver"
}

build() {
  cd "$srcdir/$pkgname-$pkgver"
  make CFLAGS+="-Wall -fPIC -D_FILE_OFFSET_BITS=64 -DXPL_PEDANTIC_STATISTICS=1 -g -ggdb -O0 -DFTBL_SORT=1 -DXPL_CHECK_CODE=1 -DXPL_X86=1 -DGEOIP_LIBRARY=0 -DLOG_COMPONENT=-2 -O -Wcpp -Werror=cpp"
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  install -dm755 "$pkgdir"/usr/bin
  install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/xplico/LICENSE
  make DEFAULT_DIR="$pkgdir"/usr/share/xplico install
}
