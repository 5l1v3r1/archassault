pkgname=ivy-ocaml
pkgver=r1.392aef3 
pkgrel=1
groups=('archassault' 'archassault-misc')
pkgdesc="A simple protocol and a set of open-source (LGPL) libraries and programs that allows applications to broadcast information through text messages, with a subscription mechanism based on regular expressions."
arch=('i686' 'x86_64' 'armv6h' 'armv7h')
url='http://www.eei.cena.fr/products/ivy/'
license=('GPL2')
depends=('ocaml')
provides=('non-gitname')
conflicts=('non-gitname')
replaces=('non-gitname')
makedepends=('git' 'ivy-c-static')
provides=('ivy-ocaml')
source=("git+https://github.com/ArchAssault-Project/ivy-ocaml.git")
options=('!libtool' '!strip')
md5sums=('SKIP')



pkgver() {
  cd "$srcdir/ivy-ocaml"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build(){
  cd "$srcdir/ivy-ocaml"
  make OSX_MACPORTS_PREFIX=/usr 
}

package() {
  OCAMLFIND_DESTDIR="${pkgdir}$(ocamlfind printconf destdir)"
  export DESTDIR="${pkgdir}"
  cd "$srcdir/ivy-ocaml"
  install -dm755 $OCAMLFIND_DESTDIR/stublibs
  export OCAMLFIND_DESTDIR="$OCAMLFIND_DESTDIR"
  OCAMLFIND_INSTFLAGS="-destdir $OCAMLFIND_DESTDIR -ldconf /dev/null" make install
}
