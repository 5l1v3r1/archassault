pkgname=paparazzi
pkgver=5.0.3
pkgrel=1
groups=('archassault' 'archassautl-drone')
pkgdesc="A free and open-source hardware and software project for unmanned (air) vehicles."
arch=('i686' 'x86_64' 'armv6h' 'armv7h')
url="http://www.eei.cena.fr/products/ivy/"
license=('BSD')
source=("https://github.com/paparazzi/paparazzi/releases/download/v${pkgver}_stable/paparazzi_v${pkgver}_stable.tar.gz"
        "paparazzi-gcc-armv7h.patch")
options=('staticlibs' '!libtool')
depends=('imagemagick' 'tkdiff' 'tk' 'tcl' 'paparazzi-gcc-armv6h')
optdepends=('gnuplot')
makedepends=('ivy-c-static' 'ivy-ocaml' 'python2-ivy' 'ocamlnet' 'lpc21isp' 'libftdi' 'libgnomecanvas'
             'libglade' 'ocaml' 'ocaml-findlib' 'ocaml-pcre' 'python2-yaml' 'paparazzi-gcc-armv7h' 'lablgtk2' 'ocaml-includepatch')
sha256sums=('e2b68494616967af60a9cfe79aa09412d0383dc49f575a591fc57cb2b9dd94c3'
            'c5d0527637799678404a3caba86c8b90d0d1e8b1f6025589a291095633dadcbb')

prepare(){
  grep -iRl 'python' "$srcdir" | xargs sed -i 's|#!.*/usr/bin/python|#!/usr/bin/python2|;s|#!.*/usr/bin/env python$|#!/usr/bin/env python2|'
}

build() {
  cd $srcdir/
  export PATH=$PATH:/usr/local/paparazzi-gcc-armv7h/arm-unknown-linux-gnueabihf/bin
  cd $srcdir/sw/ext/
  patch -p1 -i $srcdir/paparazzi-gcc-armv7h.patch
  cd $srcdir/
  make prefix=/usr
}
package() {
  cd $srcdir/
  make DESTDIR=$pkgdir install
}
