# Maintainer: ArchAssault <team@archassault.org>
pkgname=moloch
pkgver=0.11.2
pkgrel=1
pkgdesc="An open source large scale IPv4 full PCAP capturing, indexing and database system."
url="https://github.com/aol/moloch"
arch=('any')
license=('APACHE')
depends=('python2' 'yara' 'libpcap' 'geoip' 'util-linux' 'libnids' 'libpng' 'file' 'nodejs')
makedepends=('glib2')
groups=('archassault')
options=('!strip')
source=("https://github.com/aol/moloch/archive/v$pkgver.tar.gz"
        "build_fix.patch")
sha512sums=('ca6e7405fb9917b52a037e1563f1627c3076cc6046646d8d39516e8fa9b2419d8aad20d4c5a43bfef93e87c2b0c3bd9f497a5420de483a1e2a048f0efcb14a9d'
            '4c7e04a5012f7807f3e00803acd7971f4344aea7e61a62a86a88731dc93d6079a48ce78454eb5055adf140e218c04cf7f453a0618498ae1c6243129d23d038d5')

prepare() {
  cd $pkgname-$pkgver
  # patch -p1 -i ../build_fix.patch
}

build(){
  cd $pkgname-$pkgver
  ./configure --prefix=/usr
  make
}

package() {
  cd $pkgname-$pkgver
  make DESTDIR="$pkgdir" install
  #  mv "$pkgdir/usr/share/moloch/bin" "$pkgdir/usr/bin"
  find "$pkgdir" -name '*.a' -exec chmod -x '{}' +
}

