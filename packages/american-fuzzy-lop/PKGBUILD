# Maintainer: ArchAssault
pkgname=american-fuzzy-lop
pkgver=0.81b
pkgrel=1
groups=('archassault' 'archassault-fuzzers')
pkgdesc="A practical, instrumentation-driven fuzzer for binary formats" 
arch=('i686' 'x86_64')
url="https://code.google.com/p/american-fuzzy-lop/"
license=('APACHE')
if [[ $CARCH == 'x86_64' ]]; then
      depends=('lib32-glibc')
      makedepends=('gcc-multilib')
else
      depends=('glibc')
fi
options=('!strip')
source=("http://lcamtuf.coredump.cx/afl/releases/afl-${pkgver}.tgz" "makefile.patch")
sha512sums=('173813c53f29e50812ea5dfaf165ae7f6664ff54fcd46f0ada722b3ca961e39a2d62c7325ca662487c349aa05f91d68796f3d5ec08cba74f31a173ab932fa196'
            '0bce189b770d9afd930a3296d836dd2bf93a369cfaf1d68b604d6deb1090e132e7ce5bcfb8027df64870ab8459c494b809c8155583fa09859c078fab4cf627e9')

prepare(){
 cd "$srcdir/afl-$pkgver"
 patch -i $srcdir/makefile.patch
 sed -i 's|PREFIX      = /usr/local|PREFIX      = /usr|' Makefile
}
  
build() {
  cd "$srcdir/afl-$pkgver"
  make
}

package() {
  cd "$srcdir/afl-$pkgver"
  #install -dm755 $pkgdir/usr/bin
  #install -dm755 $pkgdir/usr/lib/afl
  make DESTDIR=$pkgdir install 
}
