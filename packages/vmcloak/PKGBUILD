# Maintainer: ArchAssault <team@archassault.org>
pkgname=vmcloak
pkgver=0.1.21
pkgrel=1
pkgdesc="Automated Virtual Machine Generation and Cloaking for Cuckoo Sandbox."
url="https://github.com/jbremer/vmcloak"
arch=('i686' 'x86_64')
license=('GPL3')
groups=('archassault' 'archassault-malware')
depends=('cdrtools' 'virtualbox' 'dmidecode' 'lshw' 'python2-lockfile' 'python2-sphinx')
makedepends=('python2-setuptools' 'unzip')
conflicts=('vmcloak-git')
replaces=('vmcloak-git')
source=("https://github.com/jbremer/vmcloak/archive/${pkgver}.zip")
sha512sums=('3fbcaa2cb45e5b84dc87a154cd825b4d12597324d4f21dcbe6079d1293c457124607f3b60c13cda55f6395490c84db32f6ed9894a82ffeb21d45ad8fb450d609')

prepare() {
  find "${srcdir}" -type f -name '*.py' | xargs sed -i 's|#!/usr/bin/env python|#!/usr/bin/env python2|'
  find "${srcdir}" -type f -name '*.py' | xargs sed -i 's|#!/usr/bin/python|#!/usr/bin/python2|'
}

package() {
  cd vmcloak-"${pkgver}"
  python2 setup.py install --root="${pkgdir}" --optimize=1
  install -Dm644 docs/LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt" 
}


