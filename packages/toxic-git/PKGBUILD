# Maintainer: ArchAssault <team at archassault org>
# Contributor: Kevin MacMartin <prurigro at gmail dot com>
# Contributor: Florian Hahn <flo@fhahn.com>

_pkgname=toxic
pkgname=${_pkgname}-git
_pkgver=e22b7a3
pkgver=r1398.e22b7a3
pkgrel=1
pkgdesc="An ncurses-based commandline client for Tox"
arch=('i686' 'x86_64' 'armv6h' 'armv7h')
url="https://github.com/Tox/toxic"
license=('GPL3')
depends=('tox-git=1:r2891.9c480ac-1' 'desktop-file-utils' 'freealut' 'libconfig' 'libnotify')
makedepends=('git')
provides=("$_pkgname")
conflicts=("$_pkgname")
replaces=("$_pkgname")
install="${pkgname}.install"

source=("${_pkgname}::git+${url}.git#commit=${_pkgver}"
        "${_pkgname}.desktop"
        "${_pkgname}.png"
        "manpage-fix.patch")
sha512sums=('SKIP'
            'b75913ecf0cd43f7dccf4c34fdb291f44d9b916909ac93145f2ccf63aa80d15597657c6c0919e90c6d5cf34ed22ad61abfeb9d5f60ee3afc40ac090bf428d51e'
            '13034bbb3b02beb4ac2bdbf27ab2d42a12e00d526367a4bfeec14f1bd561e8148493d562dd91ec03db963e104bb3ea640187840ba6aa856053a7bc3796b41eb6'
            '4c14f78efbb4d30cbaee3700a0af7769ca1ead68d461a015c1cf6c7e18d71e239200bf4a8d7c6f79fc349d6f003b4a2e09018659e27f0486c0658a7ea192257e')

prepare() {
    cd $_pkgname
    patch -p1 < ../manpage-fix.patch
}

pkgver() {
    cd $_pkgname
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    cd ${_pkgname}/build
    make
}

package() {
    install -Dm644 ${_pkgname}.desktop "${pkgdir}/usr/share/applications/${_pkgname}.desktop"
    install -Dm644 ${_pkgname}.png "${pkgdir}/usr/share/pixmaps/${_pkgname}.png"
    cd ${_pkgname}/build
    make PREFIX=/usr MANDIR=/usr/share/man DESTDIR="$pkgdir" install
}
