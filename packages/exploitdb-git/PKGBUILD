#Maintainer: ArchAssault <team archassault org>
pkgname=exploitdb-git
pkgver=r99.b4268e8
pkgrel=1
groups=('archassault' 'archassault-exploits')
pkgdesc="The official Exploit Database repository"
arch=('any')
url='https://github.com/offensive-security/exploit-database'
license=('GPL')
depends=('bash')
makedepends=('git')
replaces=('exploit-db')
provides=('exploit-db')
source=("exploit-database::git+https://github.com/offensive-security/exploit-database.git" "exploitdb-git.install")
install='exploitdb-git.install'
sha512sums=('SKIP'
            '7d9cda1c0d3aafad5392ed66f1f804ef8e48536cb935d12c7133315a6f53f0b14d48c1d3fc687fbdeca7ec46c99bb96368e8601c116e37a5bb6e444d907e67f6')
           

pkgver() {
  cd "$srcdir/exploit-database"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

package() {
  cd "$srcdir/exploit-database"

  # Make base directories.
  install -dm755 "$pkgdir/usr/share/exploitdb"
  install -dm755 "$pkgdir/usr/bin"
  install -dm755 "$pkgdir/usr/share/exploitdb/platforms"
  install -dm755 "$pkgdir/usr/share/exploitdb/.git"
  
  #Files
  cp -a --no-preserve=ownership platforms/* "$pkgdir/usr/share/exploitdb/platforms"
  cp -a --no-preserve=ownership .git/* "$pkgdir/usr/share/exploitdb/.git"
  install -Dm644 "README.md" "$pkgdir/usr/share/exploitdb/README.md"
  install -Dm644 "files.csv" "$pkgdir/usr/share/exploitdb/files.csv"
  install -Dm755 "searchsploit" "$pkgdir/usr/bin/searchsploit"
}
